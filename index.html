<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í•™êµí­ë ¥ ì˜ˆë°© ê·€ìš”ë¯¸ í€´ì¦ˆ</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poor+Story&display=swap');

        body {
            font-family: 'Poor Story', cursive;
            background-color: #f0f8ff;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px 0;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        .container {
            background-color: #ffffff;
            padding: 30px;
            border-radius: 25px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            width: 90%;
            max-width: 600px;
            text-align: center;
        }

        #start-page h1, #quiz-container h2, #result-page h2 {
            color: #ff69b4;
            font-size: 2.5em;
        }

        .input-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-size: 1.2em;
        }

        .input-group input,
        .input-group textarea {
            width: calc(100% - 20px);
            padding: 10px;
            border: 2px solid #ffc0cb;
            border-radius: 10px;
            font-family: 'Poor Story', cursive;
            font-size: 1.1em;
            resize: vertical;
        }

        button {
            background-color: #ff69b4;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 15px;
            cursor: pointer;
            font-family: 'Poor Story', cursive;
            font-size: 1.5em;
            transition: background-color 0.3s, transform 0.2s;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        button:hover {
            background-color: #ff1493;
            transform: translateY(-2px);
        }
        
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
            transform: none;
        }

        #quiz-container, #result-page {
            display: none;
        }
        
        #timer {
            font-size: 1.8em;
            color: #32cd32;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .question {
            margin-bottom: 30px;
            text-align: left;
            font-size: 1.4em;
        }

        .answers {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .answer {
            background-color: #f0f0f0;
            padding: 15px;
            border-radius: 10px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s;
            text-align: left;
            font-size: 1.2em;
        }

        .answer:hover {
            background-color: #e0e0e0;
            transform: scale(1.02);
        }
        
        .answer.selected {
            background-color: #add8e6;
            border: 2px solid #87ceeb;
        }

        input[type="radio"] {
            display: none;
        }
        
        #result-page p {
            font-size: 1.5em;
            color: #333;
        }

        #result-page .score {
            font-size: 3em;
            color: #ff69b4;
            font-weight: bold;
            margin: 20px 0;
        }

        #explanations {
            margin-top: 30px;
            text-align: left;
        }
        
        #explanations h3 {
            color: #ff69b4;
            font-size: 1.8em;
            border-bottom: 2px solid #ffc0cb;
            padding-bottom: 10px;
        }

        .explanation-item {
            background-color: #fff0f5;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-left: 5px solid #ff69b4;
        }

        .explanation-item p {
            margin: 8px 0;
            font-size: 1.1em;
        }
        .explanation-item .correct-answer {
            color: #228b22;
            font-weight: bold;
        }
        .explanation-item .user-answer {
            color: #dc143c;
            font-weight: bold;
        }
        .explanation-item .explanation-text {
            color: #555;
            font-size: 1em;
        }

    </style>
</head>
<body>

    <div class="container">
        <!-- ì¸ì ì‚¬í•­ ì…ë ¥ í˜ì´ì§€ (ì²« í™”ë©´) -->
        <div id="start-page">
            <h1>ğŸ« í•™êµí­ë ¥ ì˜ˆë°© í€´ì¦ˆ âœï¸</h1>
            <p style="font-size: 1.2em; color: #555;">ì—°ìˆ˜ ë‚´ìš©ì„ í€´ì¦ˆë¡œ í™•ì¸í•´ë´ìš”!</p>
            <div class="input-group">
                <label for="school">ğŸ« ì†Œì† í•™êµ</label>
                <input type="text" id="school" placeholder="ì˜ˆ) 00ì¤‘">
            </div>
            <div class="input-group">
                <label for="name">ğŸ‘¤ ì´ë¦„</label>
                <input type="text" id="name" placeholder="ì˜ˆ) ê¹€í–‰ë³µ">
            </div>
            <p id="error-message" style="color: red; display: none; font-size: 1.1em;">ì†Œì† í•™êµì™€ ì´ë¦„ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”!</p>
            <button onclick="startQuiz()">í€´ì¦ˆ ì‹œì‘!</button>
        </div>

        <!-- í€´ì¦ˆ í˜ì´ì§€ -->
        <div id="quiz-container">
            <h2>í•™êµí­ë ¥ ì˜ˆë°© í€´ì¦ˆ</h2>
            <div id="timer">00:00</div>
            <form id="quiz-form">
                <!-- í€´ì¦ˆ ë¬¸í•­ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
            </form>
            <button onclick="submitQuiz()">ê²°ê³¼ í™•ì¸í•˜ê¸°</button>
        </div>

        <!-- ê²°ê³¼ í˜ì´ì§€ -->
        <div id="result-page">
            <h2>âœ¨ í€´ì¦ˆ ê²°ê³¼ âœ¨</h2>
            <p><span id="result-school"></span> <span id="result-name"></span>ë‹˜ì˜ ì ìˆ˜ëŠ”?</p>
            <p class="score" id="score"></p>
            <p>â° ì†Œìš” ì‹œê°„: <span id="elapsed-time"></span></p>
            
            <div class="input-group" id="feedback-section">
                <label for="feedback" style="font-size:1.5em; text-align:center; margin-bottom: 15px;">ğŸ“ ì—°ìˆ˜ ì†Œê°ë¬¸</label>
                <textarea id="feedback" rows="4" placeholder="í€´ì¦ˆë¥¼ í’€ì–´ë³¸ ì†Œê°ì´ë‚˜ ì—°ìˆ˜ì— ëŒ€í•œ ì˜ê²¬ì„ ììœ ë¡­ê²Œ ë‚¨ê²¨ì£¼ì„¸ìš”."></textarea>
            </div>
            
            <button onclick="submitFeedback()" id="submit-feedback-btn">ì†Œê°ë¬¸ ì „ì†¡í•˜ê¸°</button>
            <p id="submit-status" style="display: none; margin-top: 15px; font-size: 1.2em;"></p>

            <button onclick="checkRank()" id="check-rank-btn" style="display: none; margin-top: 15px;">ğŸ† í˜„ì¬ ë“±ìˆ˜ í™•ì¸</button>
            <div id="rank-display" style="margin-top: 20px; font-size: 1.3em;"></div>

            <div id="explanations"></div>
        </div>
    </div>

    <script>
        const quizData = [
            {
                question: "1. ë‹¤ìŒ ì¤‘ 'í•™êµí­ë ¥ì˜ˆë°©ë²•'ì—ì„œ ì •ì˜í•˜ëŠ” í•™êµí­ë ¥ì— í•´ë‹¹í•˜ì§€ <u>ì•ŠëŠ”</u> ê²ƒì€ ë¬´ì—‡ì¸ê°€ìš”?",
                answers: ["í•™ìƒ ê°„ì— ë°œìƒí•œ ì‚¬ì´ë²„ ë”°ëŒë¦¼", "í•™ìƒì˜ ë¬¼ê±´ì„ ë¹¼ì•—ëŠ” í–‰ìœ„(ê³µê°ˆ)", "ì„±ì  ë¶€ì§„ìœ¼ë¡œ ì¸í•œ ë¶€ëª¨ì˜ ê¾¸ì¤‘", "ê°•ì œë¡œ ì‹¬ë¶€ë¦„ì„ ì‹œí‚¤ëŠ” í–‰ìœ„"],
                correct: "ì„±ì  ë¶€ì§„ìœ¼ë¡œ ì¸í•œ ë¶€ëª¨ì˜ ê¾¸ì¤‘",
                explanation: "í•™êµí­ë ¥ì€ 'í•™ìƒ'ì„ ëŒ€ìƒìœ¼ë¡œ ë°œìƒí•œ ì‹ ì²´, ì •ì‹ , ì¬ì‚°ìƒì˜ í”¼í•´ë¥¼ ì£¼ëŠ” í–‰ìœ„ë¥¼ ë§í•˜ë©°, ë¶€ëª¨ë‹˜ì˜ ê¾¸ì¤‘ê³¼ ê°™ì€ ì •ë‹¹í•œ êµìœ¡ í™œë™ì€ í•´ë‹¹í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤."
            },
            {
                question: "2. ì¥ë‚œìœ¼ë¡œ ì¹œêµ¬ì˜ ë°”ì§€ë¥¼ ë‚´ë¦¬ëŠ” í–‰ìœ„ëŠ” í•™êµí­ë ¥ì˜ ì—¬ëŸ¬ ìœ í˜• ì¤‘ ì–´ë””ì— ê°€ì¥ ê°€ê¹ê²Œ í•´ë‹¹ë ê¹Œìš”?",
                answers: ["ì‹ ì²´í­ë ¥", "ì„±í­ë ¥", "ì–¸ì–´í­ë ¥", "ë”°ëŒë¦¼"],
                correct: "ì„±í­ë ¥",
                explanation: "ì¥ë‚œìœ¼ë¡œ í•œ í–‰ë™ì´ë¼ë„ ìƒëŒ€ë°©ì´ ì„±ì  ìˆ˜ì¹˜ì‹¬ì´ë‚˜ êµ´ìš•ê°ì„ ëŠë¼ê²Œ í•˜ëŠ” í–‰ìœ„ëŠ” ì„±í­ë ¥ì— í•´ë‹¹í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í–‰ìœ„ì˜ ì˜ë„ë³´ë‹¤ í”¼í•´ìì˜ ê°ì •ì´ ì¤‘ìš”í•©ë‹ˆë‹¤."
            },
            {
                question: "3. ë‹¤ìŒ ì¤‘ í•™êµí­ë ¥ í”¼í•´ í•™ìƒì˜ ì§•í›„ë¡œ ë³´ê¸° <u>ì–´ë ¤ìš´</u> ê²ƒì€ ë¬´ì—‡ì¸ê°€ìš”?",
                answers: ["ëª¸ì— ì•Œ ìˆ˜ ì—†ëŠ” ìƒì²˜ë‚˜ ë©ì´ ìì£¼ ë°œê²¬ëœë‹¤.", "í•™êµ ê°€ëŠ” ê²ƒì„ ë‘ë ¤ì›Œí•˜ê³  ê²°ì„ì´ ì¦ì•„ì§„ë‹¤.", "ì‰¬ëŠ” ì‹œê°„ì— ì¹œêµ¬ë“¤ê³¼ ì–´ìš¸ë ¤ ì ê·¹ì ìœ¼ë¡œ í™œë™í•œë‹¤.", "ê°‘ìê¸° SNS ê³„ì •ì„ íƒˆí‡´í•˜ê±°ë‚˜ íœ´ëŒ€ì „í™” ì‚¬ìš©ì„ êº¼ë¦°ë‹¤."],
                correct: "ì‰¬ëŠ” ì‹œê°„ì— ì¹œêµ¬ë“¤ê³¼ ì–´ìš¸ë ¤ ì ê·¹ì ìœ¼ë¡œ í™œë™í•œë‹¤.",
                explanation: "í•™êµí­ë ¥ í”¼í•´ í•™ìƒì€ ë³´í†µ ìœ„ì¶•ë˜ì–´ í˜¼ì ìˆìœ¼ë ¤ í•˜ê±°ë‚˜ ì¹œêµ¬ ê´€ê³„ë¥¼ í”¼í•˜ëŠ” ê²½í–¥ì„ ë³´ì…ë‹ˆë‹¤. ë”°ë¼ì„œ ì‰¬ëŠ” ì‹œê°„ì— ì¹œêµ¬ë“¤ê³¼ ì ê·¹ì ìœ¼ë¡œ ì–´ìš¸ë¦¬ëŠ” ê²ƒì€ í”¼í•´ ì§•í›„ë¡œ ë³´ê¸° ì–´ë µìŠµë‹ˆë‹¤."
            },
            {
                question: "4. í•™êµí­ë ¥ ì‚¬ì•ˆì„ ì¸ì§€í–ˆì„ ê²½ìš°, í•™êµëŠ” ì–¸ì œê¹Œì§€ êµìœ¡(ì§€ì›)ì²­ì— ë³´ê³ í•´ì•¼ í•˜ë‚˜ìš”?",
                answers: ["ì¸ì§€ í›„ 12ì‹œê°„ ì´ë‚´", "ì¸ì§€ í›„ 24ì‹œê°„ ì´ë‚´", "ì¸ì§€ í›„ 48ì‹œê°„ ì´ë‚´", "ì¸ì§€ í›„ 72ì‹œê°„ ì´ë‚´"],
                correct: "ì¸ì§€ í›„ 48ì‹œê°„ ì´ë‚´",
                explanation: "í•™êµí­ë ¥ ì‚¬ì•ˆ ì²˜ë¦¬ ê·œì •ì— ë”°ë¼, í•™êµëŠ” ì¸ì§€í•œ í›„ 48ì‹œê°„ ì´ë‚´ì— êµìœ¡(ì§€ì›)ì²­ì— ë³´ê³ í•´ì•¼ í•©ë‹ˆë‹¤. ì‹ ì†í•œ ì´ˆê¸° ëŒ€ì‘ì„ ìœ„í•¨ì…ë‹ˆë‹¤."
            },
            {
                question: "5. í•™êµí­ë ¥ ì‚¬ì•ˆ ë°œìƒ ì‹œ, êµì‚¬ì˜ ì´ˆê¸° ëŒ€ì‘ìœ¼ë¡œ ì˜¬ë°”ë¥´ì§€ <u>ì•Šì€</u> í–‰ë™ì€ ë¬´ì—‡ì¸ê°€ìš”?",
                answers: ["í”¼í•´ í•™ìƒê³¼ ê°€í•´ í•™ìƒì„ ì¦‰ì‹œ ë¶„ë¦¬í•˜ì—¬ ì¶”ê°€ í”¼í•´ë¥¼ ë§‰ëŠ”ë‹¤.", "ì‚¬ì•ˆ ì¡°ì‚¬ ê³¼ì •ì—ì„œ ê°œì¸ì ì¸ ê°ì •ì„ ë“œëŸ¬ë‚´ì§€ ì•Šê³  ì¤‘ë¦½ì„ ì§€í‚¨ë‹¤.", "ë¬¸ì œë¥¼ ì¡°ìš©íˆ í•´ê²°í•˜ê¸° ìœ„í•´ êµì‚¬ ì„ ì—ì„œ ê°œì¸ì ìœ¼ë¡œ ìƒí™©ì„ ë§ˆë¬´ë¦¬í•œë‹¤.", "í•™êµì¥ì—ê²Œ ì¦‰ì‹œ ë³´ê³ í•˜ê³  ê´€ë ¨ ë‚´ìš©ì„ ì‹ ê³  ì ‘ìˆ˜ ëŒ€ì¥ì— ê¸°ë¡í•œë‹¤."],
                correct: "ë¬¸ì œë¥¼ ì¡°ìš©íˆ í•´ê²°í•˜ê¸° ìœ„í•´ êµì‚¬ ì„ ì—ì„œ ê°œì¸ì ìœ¼ë¡œ ìƒí™©ì„ ë§ˆë¬´ë¦¬í•œë‹¤.",
                explanation: "í•™êµí­ë ¥ ì‚¬ì•ˆì„ êµì‚¬ ê°œì¸ì´ íŒë‹¨í•˜ì—¬ ë§ˆë¬´ë¦¬í•˜ëŠ” ê²ƒì€ ê¸ˆì§€ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ëª¨ë“  ì‚¬ì•ˆì€ í•™êµì¥ ë³´ê³ , ëŒ€ì¥ ê¸°ë¡ ë“± ê³µì‹ì ì¸ ì ˆì°¨ì— ë”°ë¼ ì²˜ë¦¬í•´ì•¼ í•©ë‹ˆë‹¤."
            }
        ];

        let timer;
        let startTime;
        let resultData = {};
        
        // Google Apps Script ë°°í¬ URLì„ ì…ë ¥í•˜ì„¸ìš”.
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbw7BaqB96gYycM_LTuoKgdoMMT3xNECdKxNBut2Lz15cXGqDrjYoKueBH3vV3sWszeS/exec';

        function startQuiz() {
            const school = document.getElementById('school').value;
            const name = document.getElementById('name').value;
            const errorMessage = document.getElementById('error-message');

            if (!school.trim() || !name.trim()) {
                errorMessage.style.display = 'block';
                return;
            }
            errorMessage.style.display = 'none';

            resultData.school = school;
            resultData.name = name;

            document.getElementById('start-page').style.display = 'none';
            document.getElementById('quiz-container').style.display = 'block';

            generateQuiz();
            startTimer();
        }

        function startTimer() {
            startTime = new Date();
            const timerElement = document.getElementById('timer');
            timer = setInterval(() => {
                const now = new Date();
                const timeDiff = Math.floor((now - startTime) / 1000);
                const minutes = Math.floor(timeDiff / 60);
                const seconds = timeDiff % 60;
                timerElement.textContent = `${minutes}ë¶„ ${String(seconds).padStart(2, '0')}ì´ˆ`;
            }, 1000);
        }

        function generateQuiz() {
            const form = document.getElementById('quiz-form');
            let quizHTML = '';
            quizData.forEach((data, index) => {
                quizHTML += `<div class="question" id="q${index}">${data.question}</div>`;
                quizHTML += `<div class="answers">`;
                data.answers.forEach((answer, answerIndex) => {
                    const answerTextWithNumber = `${answerIndex + 1}. ${answer}`;
                    quizHTML += `
                        <label class="answer" for="q${index}a${answerIndex}">
                            <input type="radio" id="q${index}a${answerIndex}" name="question${index}" value="${answer}">
                            ${answerTextWithNumber}
                        </label>
                    `;
                });
                quizHTML += `</div><hr style="border: 0; border-top: 1px solid #eee; margin: 30px 0;">`;
            });
            form.innerHTML = quizHTML;

            document.querySelectorAll('.answer').forEach(label => {
                label.addEventListener('click', () => {
                    const radioName = label.querySelector('input[type="radio"]').name;
                    document.querySelectorAll(`input[name="${radioName}"]`).forEach(radio => {
                        radio.parentElement.classList.remove('selected');
                    });
                    label.classList.add('selected');
                });
            });
        }

        function submitQuiz() {
            clearInterval(timer);
            const endTime = new Date();
            const timeDiff = Math.floor((endTime - startTime) / 1000);
            const minutes = Math.floor(timeDiff / 60);
            const seconds = timeDiff % 60;

            const form = document.getElementById('quiz-form');
            let score = 0;
            const userAnswers = [];

            quizData.forEach((data, index) => {
                const selected = form.querySelector(`input[name="question${index}"]:checked`);
                const userAnswer = selected ? selected.value : null;
                userAnswers.push(userAnswer);
                if (userAnswer === data.correct) {
                    score++;
                }
            });
            
            resultData.score = Math.round((score / quizData.length) * 100);
            resultData.elapsedTime = `${minutes}ë¶„ ${String(seconds).padStart(2, '0')}ì´ˆ`;
            resultData.timeInSeconds = timeDiff;

            document.getElementById('quiz-container').style.display = 'none';
            document.getElementById('result-page').style.display = 'block';
            
            window.scrollTo(0, 0);

            document.getElementById('result-school').textContent = resultData.school;
            document.getElementById('result-name').textContent = resultData.name;
            document.getElementById('score').textContent = `${resultData.score}ì `;
            document.getElementById('elapsed-time').textContent = resultData.elapsedTime;
            
            // â˜… ë³€ê²½ì : ê²°ê³¼ í™•ì¸ ì‹œì ì— ë°”ë¡œ ë°ì´í„° ì „ì†¡
            sendInitialResult();
            
            displayExplanations(userAnswers);
        }

        // â˜… ì¶”ê°€ëœ í•¨ìˆ˜: ì†Œê°ë¬¸ ì—†ì´ ì´ˆê¸° ê²°ê³¼ë¥¼ ì „ì†¡
        async function sendInitialResult() {
            const formData = new FormData();
            formData.append('action', 'submitResult');
            formData.append('school', resultData.school);
            formData.append('name', resultData.name);
            formData.append('score', resultData.score);
            formData.append('elapsedTime', resultData.elapsedTime);
            formData.append('timeInSeconds', resultData.timeInSeconds);

            try {
                await fetch(GOOGLE_SCRIPT_URL, { method: 'POST', body: formData });
                console.log("Initial results submitted successfully.");
            } catch (error) {
                console.error('Error submitting initial results:', error);
            }
        }
        
        function displayExplanations(userAnswers) {
            const explanationsContainer = document.getElementById('explanations');
            let explanationsHTML = '<h3>ğŸ“ í‹€ë¦° ë¬¸ì œ ë‹¤ì‹œ ë³´ê¸°</h3>';
            let hasWrongAnswers = false;

            quizData.forEach((data, index) => {
                const userAnswer = userAnswers[index];
                if (userAnswer !== data.correct) {
                    hasWrongAnswers = true;
                    explanationsHTML += `
                        <div class="explanation-item">
                            <p><b>${data.question}</b></p>
                            <p class="correct-answer">ì •ë‹µ: ${data.correct}</p>
                            <p class="user-answer">ì„ íƒí•œ ë‹µ: ${userAnswer || 'ì„ íƒ ì•ˆ í•¨'}</p>
                            <p class="explanation-text"><b>í•´ì„¤:</b> ${data.explanation}</p>
                        </div>
                    `;
                }
            });

            if (!hasWrongAnswers) {
                explanationsHTML += '<p style="font-size: 1.2em; text-align: center; color: green;">ğŸ‰ ëª¨ë“  ë¬¸ì œë¥¼ ë§í˜”ì–´ìš”! ì™„ë²½í•´ìš”! ğŸ‰</p>';
            }

            explanationsContainer.innerHTML = explanationsHTML;
        }
        
        // â˜… ë³€ê²½ëœ í•¨ìˆ˜: ì†Œê°ë¬¸ë§Œ ì—…ë°ì´íŠ¸í•˜ë„ë¡ ì „ì†¡
        async function submitFeedback() {
            const feedback = document.getElementById('feedback').value;
            const submitStatus = document.getElementById('submit-status');
            const submitBtn = document.getElementById('submit-feedback-btn');
            const checkRankBtn = document.getElementById('check-rank-btn');
            const feedbackSection = document.getElementById('feedback-section');

            if (!feedback.trim()) {
                submitStatus.textContent = 'ğŸ“ ì†Œê°ë¬¸ì„ ë¨¼ì € ì‘ì„±í•´ì£¼ì„¸ìš”!';
                submitStatus.style.color = 'orange';
                submitStatus.style.display = 'block';
                return;
            }

            submitBtn.disabled = true;
            submitBtn.textContent = 'ì „ì†¡ ì¤‘...';
            submitStatus.style.display = 'block';
            submitStatus.style.color = 'blue';
            submitStatus.textContent = 'ì†Œê°ë¬¸ì„ ì „ì†¡í•˜ëŠ” ì¤‘...';

            const formData = new FormData();
            formData.append('action', 'submitFeedback');
            formData.append('school', resultData.school);
            formData.append('name', resultData.name);
            formData.append('feedback', feedback);

            try {
                const response = await fetch(GOOGLE_SCRIPT_URL, { method: 'POST', body: formData });
                if (response.ok) {
                    submitStatus.textContent = 'âœ… ì†Œê°ë¬¸ì´ ì„±ê³µì ìœ¼ë¡œ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤!';
                    submitStatus.style.color = 'green';
                    feedbackSection.style.display = 'none';
                    submitBtn.style.display = 'none';
                    checkRankBtn.style.display = 'inline-block';
                } else {
                    throw new Error('Server response was not ok.');
                }
            } catch (error) {
                console.error('Error:', error);
                submitStatus.textContent = 'âŒ ì „ì†¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•´ì£¼ì„¸ìš”.';
                submitStatus.style.color = 'red';
                submitBtn.disabled = false;
                submitBtn.textContent = 'ì†Œê°ë¬¸ ì „ì†¡í•˜ê¸°';
            }
        }

        async function checkRank() {
            const rankDisplay = document.getElementById('rank-display');
            const rankBtn = document.getElementById('check-rank-btn');

            rankBtn.disabled = true;
            rankBtn.textContent = 'í™•ì¸ ì¤‘...';
            rankDisplay.innerHTML = '';

            try {
                const response = await fetch(`${GOOGLE_SCRIPT_URL}?action=getRankData`);
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                const data = await response.json();

                if (data.error) {
                    rankDisplay.innerHTML = `<p style="color: orange;">${data.error}</p>`;
                } else {
                    let finalHTML = '';

                    // Display Top Ranks (1st and 2nd place)
                    if (data.ranks && data.ranks.length > 0) {
                        const medals = ['ğŸ¥‡', 'ğŸ¥ˆ'];
                        const colors = ['#f59e0b', '#6b7280'];
                        const bgColors = ['#fffbe6', '#f3f4f6'];
                        const borderColors = ['#ffecb3', '#e5e7eb'];

                        data.ranks.slice(0, 2).forEach((rank, index) => {
                            finalHTML += `
                                <div style="background-color: ${bgColors[index]}; border: 1px solid ${borderColors[index]}; padding: 15px; border-radius: 10px; margin-bottom: 10px;">
                                    <p style="margin: 0; font-size: 1.5em; color: ${colors[index]};">${medals[index]} í˜„ì¬ ${index + 1}ìœ„ ${medals[index]}</p>
                                    <p style="margin: 8px 0 0 0; font-size: 1.3em;"><b>ì´ë¦„:</b> ${rank.name}</p>
                                    <p style="margin: 4px 0 0 0; font-size: 1.2em;"><b>ì ìˆ˜:</b> ${rank.score}ì </p>
                                    <p style="margin: 4px 0 0 0; font-size: 1.2em;"><b>ì†Œìš” ì‹œê°„:</b> ${rank.elapsedTime}</p>
                                </div>
                            `;
                        });
                    } else {
                        finalHTML += '<p>ì•„ì§ ìˆœìœ„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                    }

                    // Display Best Feedback Award
                    if (data.bestFeedback) {
                        finalHTML += `
                            <div style="background-color: #e6fffa; border: 1px solid #b2f5ea; padding: 15px; border-radius: 10px; margin-top: 20px;">
                                <p style="margin: 0; font-size: 1.5em; color: #0891b2;">ğŸ“ ì†Œê° ìš°ìˆ˜ìƒ ğŸ“</p>
                                <p style="margin: 8px 0 0 0; font-size: 1.3em;"><b>ìˆ˜ìƒì:</b> ${data.bestFeedback.name} (${data.bestFeedback.school})</p>
                                <p style="margin: 8px 0 0 0; font-size: 1.2em; text-align: left; line-height: 1.6; color: #333;"><b>ì†Œê°:</b> "${data.bestFeedback.feedback}"</p>
                            </div>
                        `;
                    } else {
                        finalHTML += '<p style="margin-top: 20px;">ì†Œê° ìš°ìˆ˜ìƒ ìˆ˜ìƒìë¥¼ ì§‘ê³„ ì¤‘ì…ë‹ˆë‹¤.</p>';
                    }

                    rankDisplay.innerHTML = finalHTML;
                }
            } catch (error) {
                console.error('Error fetching rank:', error);
                rankDisplay.innerHTML = '<p style="color: red;">ë“±ìˆ˜ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.</p>';
            } finally {
                rankBtn.disabled = false;
                rankBtn.textContent = 'ğŸ† í˜„ì¬ ë“±ìˆ˜ í™•ì¸';
            }
        }
    </script>
</body>
</html>


